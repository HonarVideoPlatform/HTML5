<!DOCTYPE HTML>
<html>
<head>
<title>Cue Points example html5 / kdp</title>
<script type="text/javascript" src="../../../tests/qunit/qunit-bootstrap.js"></script>
<script type="text/javascript" src="https://ajax.googleapis.com/ajax/libs/jquery/1.4.2/jquery.js"></script>
<script type="text/javascript" src="../../../mwEmbedLoader.php"></script>
<script type="text/javascript">
	var myPlayer;
	/* Load Temp Cue Points
	** Basic example from server */
	mw.setConfig( 'Kaltura.TempCuePoints', [
		{ "code" : "SOME CODE",
        "createdAt" : 1310457621,
        "cuePointType" : "codeCuePoint.Code",
        "description" : "Code Cue Point",
        "entryId" : "0_qbtp2ceb",
        "forceStop" : null,
        "id" : "0_1kszo2z6",
        "partnerData" : null,
        "partnerId" : 495794,
        "partnerSortValue" : null,
        "startTime" : 3000,
        "status" : 1,
        "systemName" : null,
        "tags" : null,
        "thumbOffset" : null,
        "updatedAt" : 1310457621,
        "userId" : "ran@mailinator.com"
		},
		{ "adType" : 2,
        "createdAt" : 1310457025,
        "cuePointType" : "adCuePoint.Ad",
        "duration" : 7000,
        "endTime" : 13000,
        "entryId" : "0_qbtp2ceb",
        "forceStop" : null,
        "id" : "0_0nmqtoor",
        "partnerData" : null,
        "partnerId" : 495794,
        "partnerSortValue" : null,
        "protocolType" : 1,
        "sourceUrl" : "http://kaldev.kaltura.com/myopenx/www/delivery/fc.php?script=bannerTypeHtml:vastInlineBannerTypeHtml:vastInlineHtml&source=&format=vast&charset=UTF_8&nz=1&zones=z1=19",
        "startTime" : 6000,
        "status" : 1,
        "systemName" : null,
        "tags" : "vast",
        "thumbOffset" : null,
        "title" : "My Overlay",
        "updatedAt" : 1310457025,
        "userId" : "ran@mailinator.com"
		},
		{ "code" : "SOME CODE",
        "createdAt" : 1310457894,
        "cuePointType" : "codeCuePoint.Code",
        "description" : "Code Cue Point 2",
        "entryId" : "0_qbtp2ceb",
        "forceStop" : null,
        "id" : "0_sud78fly",
        "partnerData" : null,
        "partnerId" : 495794,
        "partnerSortValue" : null,
        "startTime" : 20000,
        "status" : 1,
        "systemName" : null,
        "tags" : null,
        "thumbOffset" : null,
        "updatedAt" : 1310457894,
        "userId" : "ran@mailinator.com"
		},
		{ "adType" : 1,
        "createdAt" : 1310457850,
        "cuePointType" : "adCuePoint.Ad",
        "duration" : 0,
        "endTime" : 0,
        "entryId" : "0_qbtp2ceb",
        "forceStop" : true,
        "id" : "0_oxx941wi",
        "partnerData" : null,
        "partnerId" : 495794,
        "partnerSortValue" : null,
        "protocolType" : 1,
        "sourceUrl" : "http://d1.openx.org/fc.php?script=bannerTypeHtml:vastInlineBannerTypeHtml:vastInlineHtml&source=&format=vast&charset=UTF_8&nz=1&zones=z1=182104",
        "startTime" : 30000,
        "status" : 1,
        "systemName" : null,
        "tags" : null,
        "thumbOffset" : null,
        "title" : "Midroll",
        "updatedAt" : 1310457850,
        "userId" : "ran@mailinator.com"
		}
    ]);
	
	// Bind to cuePointReached event
	var jsCallbackReady = function( playerId ) {
		myPlayer = $j('#' + playerId ).get(0);

		myPlayer.addJsListener("cuePointReached", "writeLog");
		myPlayer.addJsListener("adOpportunity", "writeLog");
	};

	var writeLog = function( qPoint ) {
		trackEventForTests( qPoint );
		var type = (qPoint.context) ? 'Ad' : 'Code';
		$j('#eventRowDesc').after(
			$j('<tr />' ).append(
				$j('<td />').text( (qPoint.cuePoint.title) ? qPoint.cuePoint.title : qPoint.cuePoint.description ),
				$j('<td />').text( type ),
				$j('<td />').text( qPoint.cuePoint.startTime )
			)
		);
	};
</script>
<script type="text/javascript" src="resources/qunit-kaltura-bootstrap.js"></script>
<script type="text/javascript">	
var testEventObject = {};
//we use this round about way of tracking events to show the events are being sent for google.
function trackEventForTests( qPoint ) {
	if(  qPoint.context == "pre" ){
		$j( testEventObject ).trigger( 'preCueEvent', qPoint );
	}
	if( !qPoint.context ){
		$j( testEventObject ).trigger( 'cueEvent', qPoint );
	}
}
function jsKalturaPlayerTest( videoId ){
	// Name this module
	module( "CuePoints" );

	var kdp = $j( '#' + videoId ).get(0);
	
	asyncTest("start cue point", function(){
		kalturaQunitWaitForPlayer(function(){
			$j( testEventObject ).bind('preCueEvent', function(event, qPoint){
				var type = (qPoint.context) ? 'Ad' : 'Code';
				equal( qPoint.cuePoint.title, "Preroll", "Preroll event sent" );
				equal( qPoint.context, "pre", "Preroll Ad cue event sent" );
				// continue testing
				start();
			});
			kdp.sendNotification('doPlay');
		});
	});
	asyncTest("CuePoint 1 at 3 seconds", function(){
		$j( testEventObject ).bind('cueEvent', function( event, qPoint ){
			equal( qPoint.cuePoint.description, "Code Cue Point", "Code Cue Point event text sent");
			equal( qPoint.cuePoint.startTime, 3000, "Code Cue Point event sent" );
			// Finish tests:
			kdp.sendNotification('doPause');
			start();
		});		
	});

}
</script>
</head>
<body>
<h2> Cue Points for kdp flash player and html5 player </h2>
<h4> Preroll from uiConf, other ads from cue points</h4>
<a href="?forceMobileHTML5"> Force Mobile Safari</a> for testing with desktop chrome and safari.
<br /><br />

<div style="float:left">
<object id="kaltura_player" name="kaltura_player" type="application/x-shockwave-flash" allowFullScreen="true" allowNetworking="all" allowScriptAccess="always" height="330" width="400" bgcolor="#000000" xmlns:dc="http://purl.org/dc/terms/" xmlns:media="http://search.yahoo.com/searchmonkey/media/" rel="media:video" resource="http://www.kaltura.com/index.php/kwidget/cache_st/1310313522/wid/_423851/uiconf_id/5143401/entry_id/1_sqv8eppy" data="http://www.kaltura.com/index.php/kwidget/cache_st/1310313522/wid/_423851/uiconf_id/5143401/entry_id/1_sqv8eppy"><param name="allowFullScreen" value="true" /><param name="allowNetworking" value="all" /><param name="allowScriptAccess" value="always" /><param name="bgcolor" value="#000000" /><param name="flashVars" value="&externalInterfaceDisabled=false" /><param name="movie" value="http://www.kaltura.com/index.php/kwidget/cache_st/1310313522/wid/_423851/uiconf_id/5143401/entry_id/1_sqv8eppy" /><a href="http://corp.kaltura.com">video platform</a> <a href="http://corp.kaltura.com/video_platform/video_management">video management</a> <a href="http://corp.kaltura.com/solutions/video_solution">video solutions</a> <a href="http://corp.kaltura.com/video_platform/video_publishing">video player</a> <a rel="media:thumbnail" href="http://cdnbakmi.kaltura.com/p/423851/sp/42385100/thumbnail/entry_id/1_sqv8eppy/width/120/height/90/bgcolor/000000/type/2"></a> <span property="dc:description" content=""></span><span property="media:title" content="Charlie bit my finger"></span> <span property="media:width" content="400"></span><span property="media:height" content="330"></span> <span property="media:type" content="application/x-shockwave-flash"></span> </object>
</div>
<div style="float:left;padding-left:20px" >
	<i>Cue Points events: </i><br />
	<table border="1" width="520">
	<tr id="eventRowDesc">
		<td>Name</td>
		<td>Type</td>
		<td>Start Time</td>
	</tr>
	</table>
</div>

</body>
</html>
